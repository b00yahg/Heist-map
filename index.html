import React, { useState } from 'react';

const HeistMap = () => {
  const [hoveredRoom, setHoveredRoom] = useState(null);
  
  const containerStyle = {
    fontFamily: 'Georgia, serif',
    maxWidth: '900px',
    margin: '0 auto',
    padding: '20px',
    backgroundColor: '#f5e7d3',
    border: '2px solid #5a3921',
    borderRadius: '10px',
    color: '#5a3921',
    position: 'relative',
    boxShadow: '0 0 15px rgba(0,0,0,0.1)'
  };
  
  const titleStyle = {
    textAlign: 'center',
    marginBottom: '20px',
  };
  
  const mapAreaStyle = {
    position: 'relative',
    height: '650px',
    border: '1px solid #5a3921',
    backgroundColor: '#f5e7d3',
    overflow: 'hidden',
    borderRadius: '5px'
  };
  
  const roomStyle = {
    position: 'absolute',
    border: '2px solid #5a3921',
    backgroundColor: '#f5e7d3',
    padding: '8px',
    textAlign: 'center',
    transition: 'box-shadow 0.2s, background-color 0.2s',
    cursor: 'pointer',
    zIndex: 3
  };
  
  const tooltipStyle = {
    position: 'absolute',
    backgroundColor: 'rgba(245, 231, 211, 0.95)',
    border: '1px solid #5a3921',
    borderRadius: '5px',
    padding: '10px',
    boxShadow: '0 3px 6px rgba(0,0,0,0.16)',
    fontSize: '12px',
    maxWidth: '180px',
    zIndex: 100,
    pointerEvents: 'none',
    transition: 'opacity 0.2s',
    opacity: 0
  };
  
  const pathStyle = {
    position: 'absolute',
    backgroundColor: '#5a3921',
    zIndex: 1
  };
  
  const rooms = [
    {
      id: 'central-hub',
      name: 'CENTRAL HUB',
      detail: 'Multi-level with walkways',
      tooltip: 'Contains pressure valve that requires coordination with Water Regulation room.',
      isCircle: true,
      left: 400,
      top: 300,
      width: 120,
      height: 120,
      hasWaterControl: true,
      waterControlPos: { top: 70, left: 60 }
    },
    {
      id: 'storage-room',
      name: 'STORAGE ROOM',
      detail: 'Uniforms & Control Tables',
      tooltip: 'Various uniforms and Control Tables that can control different systems.',
      left: 180,
      top: 150,
      width: 100,
      height: 100
    },
    {
      id: 'intelligence-center',
      name: 'INTELLIGENCE CENTER',
      detail: 'Guild Records',
      tooltip: 'Record room containing various records of the guild.',
      left: 320,
      top: 100,
      width: 110,
      height: 100,
      hasEye: true,
      eyePos: { top: 20, left: 20 }
    },
    {
      id: 'sleeping-area',
      name: 'SLEEPING AREA',
      detail: 'Guard Quarters',
      tooltip: 'Contains sleeping quarters for guild members.',
      left: 500,
      top: 100,
      width: 100,
      height: 100,
      hasEye: true,
      eyePos: { top: 20, left: 20 }
    },
    {
      id: 'water-regulation',
      name: 'WATER REGULATION',
      detail: 'Main Controls',
      tooltip: 'Contains the main water control valves for the complex.',
      left: 670,
      top: 100,
      width: 100,
      height: 100,
      hasWaterControl: true,
      waterControlPos: { top: 70, left: 20 }
    },
    {
      id: 'watch-post-a',
      name: 'WATCH POST A',
      detail: 'Scrying Pool',
      tooltip: 'Monitors northern passageways. Manned by two guards that switch every three hours. Note: Goblins are personally unionized and dedicated to clocking out even if there\'s no one to replace them.',
      left: 240,
      top: 400,
      width: 100,
      height: 100,
      hasEye: true,
      eyePos: { top: 70, left: 20 }
    },
    {
      id: 'watch-post-b',
      name: 'WATCH POST B',
      detail: 'Scrying Pool',
      tooltip: 'Contains a scrying pool that monitors eastern areas.',
      left: 560,
      top: 350,
      width: 100,
      height: 100,
      hasEye: true,
      eyePos: { top: 70, left: 20 }
    },
    {
      id: 'armory',
      name: 'ARMORY',
      detail: '',
      tooltip: 'Storage for weapons and armor.',
      left: 450,
      top: 450,
      width: 90,
      height: 90,
      hasEye: true,
      eyePos: { top: 40, left: 20 }
    },
    {
      id: 'interrogation-chamber',
      name: 'INTERROGATION CHAMBER',
      detail: 'Likely where Floon is',
      tooltip: 'Most likely where Floon is being held.',
      left: 650,
      top: 480,
      width: 110,
      height: 100,
      hasEye: true,
      eyePos: { top: 20, left: 20 }
    },
    {
      id: 'flooded-passage',
      name: 'FLOODED PASSAGE',
      detail: 'Water Level Varies',
      tooltip: 'Water level controlled by red valve in Water Regulation room.',
      left: 740,
      top: 400,
      width: 90,
      height: 90,
      hasEye: true,
      eyePos: { top: 20, left: 20 }
    },
    {
      id: 'trash-compactor',
      name: 'TRASH COMPACTOR',
      detail: 'Exit only',
      tooltip: 'Proper exit but unable to enter. Trash can exit, but no way to reverse the process.',
      left: 720,
      top: 220,
      width: 90,
      height: 90
    },
    {
      id: 'portal-room',
      name: 'PORTAL ROOM',
      detail: 'Pressure Floor',
      tooltip: 'Contains a magical portal activated by a special stone eye.',
      left: 400,
      top: 550,
      width: 90,
      height: 90
    },
    {
      id: 'hostel-cellar',
      name: 'HOSTEL CELLAR',
      detail: 'Wererat Deliveries',
      tooltip: 'Wererats conduct deliveries at dawn and dusk of large wine barrels.',
      left: 120,
      top: 500,
      width: 100,
      height: 100
    }
  ];

  // Paths for corridors
  const paths = [
    // Main vertical corridor
    { isHorizontal: false, left: 460, top: 170, height: 380 },
    
    // Main horizontal corridor
    { isHorizontal: true, left: 240, top: 360, width: 500 },
    
    // Connect to Storage Room
    { isHorizontal: true, left: 240, top: 200, width: 40 },
    { isHorizontal: false, left: 240, top: 200, height: 160 },
    
    // Connect to Intelligence Center
    { isHorizontal: true, left: 375, top: 170, width: 85 },
    
    // Connect to Sleeping Area
    { isHorizontal: true, left: 460, top: 150, width: 40 },
    
    // Connect to Water Regulation
    { isHorizontal: true, left: 600, top: 150, width: 70 },
    
    // Connect to Watch Post A
    { isHorizontal: false, left: 290, top: 360, height: 40 },
    
    // Connect to Watch Post B
    { isHorizontal: false, left: 610, top: 350, height: 10 },
    
    // Connect to Armory
    { isHorizontal: false, left: 490, top: 450, height: 0 },
    
    // Connect to Interrogation Chamber
    { isHorizontal: true, left: 650, top: 480, width: 0 },
    { isHorizontal: false, left: 650, top: 360, height: 120 },
    
    // Connect to Flooded Passage
    { isHorizontal: true, left: 650, top: 445, width: 90 },
    
    // Connect to Portal Room
    { isHorizontal: false, left: 445, top: 550, height: 0 },
    
    // Connect to Hostel Cellar
    { isHorizontal: true, left: 170, top: 500, width: 70 },
    { isHorizontal: false, left: 170, top: 360, height: 140 }
  ];

  // Alternative paths (dashed)
  const altPaths = [
    // Service Tunnel
    { isHorizontal: false, left: 200, top: 200, height: 300 },
    
    // Hidden Passage to Trash Compactor
    { isHorizontal: false, left: 765, top: 310, height: 90 }
  ];

  // Water effects
  const waterEffects = [
    // Red control - affects flooded passage
    { left: 740, top: 460, width: 90, height: 8 },
    
    // Blue control - affects corridor Hub to Sleeping Area
    { left: 460, top: 145, width: 40, height: 8 },
    
    // Yellow control - emergency flush
    { left: 646, top: 360, width: 8, height: 120 }
  ];
  
  // Guard patrol area
  const guardPatrol = { left: 430, top: 320, width: 60, height: 60 };
  
  // Notes and Legend components
  const Notes = () => (
    <div style={{
      position: 'absolute',
      top: '20px',
      left: '20px',
      width: '180px',
      padding: '10px',
      border: '2px solid #5a3921',
      backgroundColor: '#f5e7d3',
      borderRadius: '5px',
      zIndex: 10
    }}>
      <div style={{ fontWeight: 'bold', fontSize: '14px', textAlign: 'center', marginBottom: '10px' }}>
        IMPORTANT NOTES
      </div>
      <div style={{ fontSize: '11px', marginBottom: '5px' }}>• Eyes = magical surveillance</div>
      <div style={{ fontSize: '11px', marginBottom: '5px' }}>• Water controls require TWO operators (Hub + Regulation)</div>
      <div style={{ fontSize: '11px', marginBottom: '5px' }}>• Goblins sleep 30min, patrol 15min</div>
      <div style={{ fontSize: '11px', marginBottom: '5px' }}>• Prisoner unattended 10min/hour</div>
      <div style={{ fontSize: '11px', marginBottom: '5px' }}>• Red control - affects flooded passage water level</div>
      <div style={{ fontSize: '11px', marginBottom: '5px' }}>• Blue control - affects corridor between Hub and Sleeping Area</div>
      <div style={{ fontSize: '11px', marginBottom: '5px' }}>• Yellow control - emergency flush, creates diversion</div>
      <div style={{ fontSize: '11px', marginBottom: '5px' }}>• Maintenance workers at dawn and dusk</div>
      <div style={{ fontSize: '11px', marginBottom: '5px' }}>• Guard changes every 4 hours</div>
    </div>
  );
  
  const Legend = () => (
    <div style={{
      position: 'absolute',
      top: '20px',
      right: '20px',
      width: '160px',
      padding: '10px',
      border: '2px solid #5a3921',
      backgroundColor: '#f5e7d3',
      borderRadius: '5px',
      zIndex: 10
    }}>
      <div style={{ fontWeight: 'bold', fontSize: '14px', textAlign: 'center', marginBottom: '10px' }}>
        LEGEND
      </div>
      
      <div style={{ display: 'flex', alignItems: 'center', marginBottom: '8px' }}>
        <div style={{ 
          width: '14px', 
          height: '14px', 
          borderRadius: '50%', 
          border: '2px solid #cc0000', 
          marginRight: '8px' 
        }}></div>
        <span style={{ fontSize: '11px' }}>Eye Surveillance</span>
      </div>
      
      <div style={{ display: 'flex', alignItems: 'center', marginBottom: '8px' }}>
        <div style={{ 
          width: '14px', 
          height: '14px', 
          border: '2px solid #0066cc', 
          marginRight: '8px' 
        }}></div>
        <span style={{ fontSize: '11px' }}>Water Controls</span>
      </div>
      
      <div style={{ display: 'flex', alignItems: 'center', marginBottom: '8px' }}>
        <div style={{ 
          width: '20px', 
          height: '0px', 
          border: '2px dashed #5a3921',
          marginRight: '8px' 
        }}></div>
        <span style={{ fontSize: '11px' }}>Alternative Path</span>
      </div>
      
      <div style={{ display: 'flex', alignItems: 'center', marginBottom: '8px' }}>
        <div style={{ 
          width: '20px', 
          height: '8px', 
          backgroundColor: 'rgba(0, 102, 0, 0.3)',
          marginRight: '8px' 
        }}></div>
        <span style={{ fontSize: '11px' }}>Water Level Affected</span>
      </div>
      
      <div style={{ display: 'flex', alignItems: 'center' }}>
        <div style={{ 
          width: '20px', 
          height: '14px', 
          border: '2px dashed #cc6600',
          marginRight: '8px' 
        }}></div>
        <span style={{ fontSize: '11px' }}>Guard Patrol</span>
      </div>
    </div>
  );
  
  const Scale = () => (
    <div style={{
      position: 'absolute',
      bottom: '15px',
      left: '50%',
      transform: 'translateX(-50%)',
      textAlign: 'center'
    }}>
      <div style={{
        width: '100px',
        height: '2px',
        backgroundColor: '#5a3921',
        margin: '0 auto 5px'
      }}></div>
      <div style={{ fontSize: '12px' }}>1 square = 5 feet</div>
    </div>
  );
  
  return (
    <div style={containerStyle}>
      <div style={titleStyle}>
        <h1 style={{ margin: '0 0 5px 0', fontSize: '28px' }}>XANATHAR GUILD HIDEOUT</h1>
        <p style={{ margin: 0, fontStyle: 'italic', fontSize: '16px' }}>Reconnaissance Blueprint</p>
      </div>
      
      <div style={mapAreaStyle}>
        <Notes />
        <Legend />
        
        {/* Main Corridors */}
        {paths.map((path, index) => (
          <div 
            key={`path-${index}`} 
            style={{
              ...pathStyle,
              left: `${path.left}px`,
              top: `${path.top}px`,
              width: path.isHorizontal ? `${path.width}px` : '4px',
              height: path.isHorizontal ? '4px' : `${path.height}px`,
            }}
          />
        ))}
        
        {/* Alternative Paths */}
        {altPaths.map((path, index) => (
          <div 
            key={`alt-path-${index}`} 
            style={{
              position: 'absolute',
              left: `${path.left}px`,
              top: `${path.top}px`,
              width: path.isHorizontal ? `${path.width}px` : '2px',
              height: path.isHorizontal ? '2px' : `${path.height}px`,
              borderLeft: path.isHorizontal ? 'none' : '2px dashed #5a3921',
              borderTop: path.isHorizontal ? '2px dashed #5a3921' : 'none',
              zIndex: 1
            }}
          />
        ))}
        
        {/* Water Effects */}
        {waterEffects.map((effect, index) => (
          <div 
            key={`water-effect-${index}`} 
            style={{
              position: 'absolute',
              left: `${effect.left}px`,
              top: `${effect.top}px`,
              width: `${effect.width}px`,
              height: `${effect.height}px`,
              backgroundColor: 'rgba(0, 102, 0, 0.3)',
              zIndex: 1
            }}
          />
        ))}
        
        {/* Guard Patrol */}
        <div 
          style={{
            position: 'absolute',
            left: `${guardPatrol.left}px`,
            top: `${guardPatrol.top}px`,
            width: `${guardPatrol.width}px`,
            height: `${guardPatrol.height}px`,
            border: '2px dashed #cc6600',
            zIndex: 1
          }}
        />
        <div 
          style={{
            position: 'absolute',
            left: `${guardPatrol.left + guardPatrol.width/2 - 30}px`,
            top: `${guardPatrol.top - 20}px`,
            fontSize: '10px',
            color: '#cc6600',
            fontStyle: 'italic'
          }}
        >
          10-min patrol
        </div>
        
        {/* Rooms */}
        {rooms.map(room => {
          const isHovered = hoveredRoom === room.id;
          const baseStyle = {
            ...roomStyle,
            left: `${room.left}px`,
            top: `${room.top}px`,
            width: `${room.width}px`,
            height: `${room.height}px`,
            boxShadow: isHovered ? '0 0 8px rgba(90, 57, 33, 0.5)' : 'none',
            backgroundColor: isHovered ? 'rgba(245, 231, 211, 0.7)' : '#f5e7d3',
            borderRadius: room.isCircle ? '50%' : '0'
          };
          
          // Calculate tooltip position
          let tooltipLeft = room.width + 10;
          let tooltipTop = 20;
          
          // Adjust tooltip position for right side rooms
          if (room.left > 500) {
            tooltipLeft = -190;
          }
          
          // Adjust tooltip position for bottom rooms
          if (room.top > 400) {
            tooltipTop = -60;
          }
          
          return (
            <div 
              key={room.id}
              style={baseStyle}
              onMouseEnter={() => setHoveredRoom(room.id)}
              onMouseLeave={() => setHoveredRoom(null)}
            >
              <div style={{ 
                fontWeight: 'bold', 
                fontSize: room.name.length > 15 ? '12px' : '14px', 
                marginBottom: '3px',
                lineHeight: 1.2
              }}>
                {room.name}
              </div>
              {room.detail && (
                <div style={{ fontStyle: 'italic', fontSize: '11px', lineHeight: 1.2 }}>
                  {room.detail}
                </div>
              )}
              
              {/* Eye Symbol */}
              {room.hasEye && (
                <div style={{
                  position: 'absolute',
                  width: '12px',
                  height: '12px',
                  borderRadius: '50%',
                  border: '2px solid #cc0000',
                  top: `${room.eyePos.top}px`,
                  left: `${room.eyePos.left}px`
                }} />
              )}
              
              {/* Water Control */}
              {room.hasWaterControl && (
                <div style={{
                  position: 'absolute',
                  width: '12px',
                  height: '12px',
                  border: '2px solid #0066cc',
                  top: `${room.waterControlPos.top}px`,
                  left: `${room.waterControlPos.left}px`
                }} />
              )}
              
              {/* Tooltip */}
              <div style={{
                ...tooltipStyle,
                left: `${tooltipLeft}px`,
                top: `${tooltipTop}px`,
                opacity: isHovered ? 1 : 0
              }}>
                {room.tooltip}
              </div>
            </div>
          );
        })}
        
        <Scale />
      </div>
    </div>
  );
};

export default HeistMap;
